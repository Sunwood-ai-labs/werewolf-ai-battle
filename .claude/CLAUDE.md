# Werewolf AI Battle - ゲームルール & チャット仕様

このプロジェクトは、AIエージェント同士が人狼ゲームで対戦するプラットフォームです。

## ゲーム概要

人狼ゲームは、村人チームと人狼チームに分かれて対戦する推理・交渉ゲームです。

### 勝利条件

- **村人チームの勝利**: 全ての人狼を処刑する
- **人狼チームの勝利**: 人狼の数が村人の数以上になる

## 役職一覧

### 村人チーム

| 役職 | 説明 | 特殊能力 |
|------|------|----------|
| 村人 | 特殊能力を持たない一般市民 | なし |
| 占い師 | 夜に1人の正体を占うことができる | 占い結果（人狼かそうでないか）を知る |
| 霊媒師 | 処刑された人の正体を確認できる | 前日処刑された人の役職を知る |
| 狩人 | 夜に1人を護衛できる | 護衛した人は人狼に殺されない |

### 人狼チーム

| 役職 | 説明 | 特殊能力 |
|------|------|----------|
| 人狼 | 夜に1人を選んで襲撃できる | 他の人狼を知ることができる |
| 狂人 | 人狼チームですが、村人のふりをする | 人狼からは正体がバレている |

## ゲームの流れ

**注意**: ゲームはサーバー側で自動進行します。各フェーズに制限時間があり、時間が切れると自動的に次のフェーズに遷移します。

### フェーズ時間

| フェーズ | 時間 | 説明 |
|---------|------|------|
| 挨拶 | 60秒 | 最初の自己紹介タイム |
| 議論 | 60秒 | 自由に議論するフェーズ |
| 投票 | 20秒 | 処刑対象を投票で決める |
| 人狼 | 20秒 | 人狼が襲撃対象を選ぶ（人狼のみ通知） |
| 占い | 20秒 | 占い師が占い対象を選ぶ（占い師のみ通知） |

### 1. 準備フェーズ（挨拶）

1. 各プレイヤーが自分の役職を知る
2. 人狼は互いの正体を確認する
3. 最初の「挨拶」タイム（60秒）

### 2. 昼フェーズ（議論 → 投票）

1. **議論フェーズ**（60秒）：自由に議論する
2. **投票フェーズ**（20秒）：処刑対象を投票で決める
3. 最多票を獲得した人が処刑される
4. 処刑された人の役職が公開される

### 3. 夜フェーズ（人狼 → 占い → 朝）

1. **人狼フェーズ**（20秒）：人狼が襲撃対象を選ぶ（人狼のみ通知）
2. **占いフェーズ**（20秒）：占い師が占い対象を選ぶ（占い師のみ通知）
3. 狩人が護衛対象を選ぶ
4. 翌朝、襲撃結果が発表される

### 4. 勝利判定

各朝、勝利条件を満たしているか判定する。満たしている場合、ゲーム終了。

## チャット仕様

このプロジェクトでは、WebSocketベースのチャットサーバーを使用します。

### サーバー接続

```
ws://localhost:8765
```

### チャンネル

| チャンネル名 | アクセス権限 | 説明 |
|-------------|-------------|------|
| `public` | 全員 | 全プレイヤーが閲覧・発言可能 |
| `werewolf` | 人狼のみ | 人狼同士の秘密の会話 |

### メッセージ形式

#### プレイヤー登録

```json
{
  "type": "register",
  "player_id": "unique-player-id",
  "name": "プレイヤー名",
  "role": "villager|werewolf|seer|bodyguard|..."
}
```

#### チャットメッセージ送信

```json
{
  "type": "chat",
  "channel": "public|werewolf",
  "content": "メッセージ内容"
}
```

#### ゲームアクション（投票、襲撃など）

```json
{
  "type": "action",
  "action": "vote|attack|guard|divine",
  "target": "対象プレイヤー名"
}
```

#### 残り時間取得

```json
{
  "type": "get_time_remaining"
}
```

レスポンス例：

```json
{
  "type": "time_remaining",
  "current_phase": "discussion",
  "time_remaining": 45
}
```

#### 過去ログ取得

```json
{
  "type": "get_history",
  "channel": "public",
  "count": 10
}
```

### レスポンス形式

全てのレスポンスには、現在のフェーズと残り時間が含まれます。

```json
{
  "type": "history|chat|system|...",
  "current_phase": "discussion",
  "time_remaining": 45,
  ...
}
```

### システム通知

サーバーから各プレイヤーにシステム通知が送信されます。

- **議論終了**: 「議論終了です。投票してください！」
- **人狼フェーズ**: 「人狼の人は襲撃対象を選んでください」（人狼のみ）
- **占いフェーズ**: 「占い師は占い対象を選んでください」（占い師のみ）

システム通知は `public` チャンネルの履歴にも残ります。

### 神視点（Godview）モード

神視点クライアントは、全ての会話とゲーム状況をリアルタイムで確認できます。

```json
{
  "type": "godview"
}
```

## AIエージェントの行動指針

### AIとしての役割

1. **自分の役職に応じた行動**: 与えられた役職の特性を理解し、それに応じた戦略をとる
2. **会話への参加**: 積極的に議論に参加し、情報を共有・分析する
3. **推論と投票**: 発言内容や行動から人狼を推論し、投票に反映させる
4. **協力または騙乱**: 村人なら協力し、人狼なら村人を欺く

### プロンプトの例

#### 村人の場合

```
あなたは人狼ゲームの「村人」です。
他のプレイヤーと協力して人狼を見つけ出してください。
まず自己紹介をしてください。
```

#### 人狼の場合

```
あなたは人狼ゲームの「人狼」です。
村人のふりをして、誰も気づかないようにしてください。
まず自己紹介をしてください。
```

#### 占い師の場合

```
あなたは人狼ゲームの「占い師」です。
夜に誰か1人の正体を占うことができます。
占い結果をどう使うか戦略的に考えてください。
まず自己紹介をしてください。
```

