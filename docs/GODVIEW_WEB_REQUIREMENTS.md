# Godview Webアプリ 要件定義

## プロジェクト概要

人狼ゲームAI対戦プラットフォーム「WEREWOLF AI BATTLE」の神視点（Godview）機能を、CLIからWebアプリケーションに移行する。

## 目的

- WebSocketサーバーに接続し、リアルタイムでゲーム状況を可視化
- 全プレイヤーの状態、全チャンネルの会話、ゲームの進行状況を監視

## 画面に必要な要素

### 必須要素

| 要素 | 説明 | 優先度 |
|------|------|--------|
| **アプリケーションヘッダー** | タイトルと接続状態 | 高 |
| **フェーズインジケーター** | 現在のゲームフェーズと残り時間 | 高 |
| **プレイヤー一覧** | 全プレイヤーの情報 | 高 |
| **チャンネルセレクター** | チャンネルの切り替え | 中 |
| **チャットログ** | チャンネルのメッセージ履歴 | 高 |
| **イベントログ** | システムイベント | 低 |

### データ構造

#### プレイヤー情報
```typescript
interface Player {
  id: string;
  name: string;
  role: 'villager' | 'werewolf' | 'seer' | 'bodyguard' | 'medium';
  is_alive: boolean;
}
```

#### チャットメッセージ
```typescript
interface ChatMessage {
  type: 'chat' | 'system';
  timestamp: string;  // ISO 8601形式
  player?: string;
  role?: string;
  content: string;
  current_phase?: string;
  time_remaining?: number;
}
```

#### フェーズ情報
- waiting（待機中）
- introduction（挨拶）
- discussion（議論）
- voting（投票）
- werewolf（人狼）
- seer（占い）
- day_end（朝）

## デザインの方向性

### 最優先：見やすさ

**チャットメッセージ**
- メッセージ同士の区切りを明確に
- プレイヤー名とメッセージ内容の視覚的な分離
- タイムスタンプは控えめに
- 役職による色分けは、視認性を損なわない程度に

**プレイヤー一覧**
- 生存状態が一目でわかるように
- 人狼の役職は、神視点なので隠さず表示
- 情報が詰まりすぎないように余白を持たせる

### 次に優先：リアルタイム性

**情報の鮮度**
- 新しいメッセージが来たら即座に反映
- フェーズが変わったらすぐにフィードバック
- 残り時間はカウントダウンで

**自動スクロール**
- 最新のメッセージが見えるように
- ユーザーが過去を遡っている場合は自動スクロールを停止

### 強調してほしいポイント

**1. フェーズと残り時間**
- これが一番重要な情報
- 常に見える場所に配置
- 残り時間が少なくなったら視覚的にアピール

**2. システムメッセージ**
- 「議論終了です。投票してください！」のようなシステム通知は目立つように
- 通常のチャットメッセージと区別する

**3. 人狼の動き**
- 人狼チャンネル（werewolf）の会話は、神視点ならではの情報
- 人狼チャンネルを切り替えたとき、それがわかるように

### UXの方向性

**情報の優先順位**
1. **今のフェーズと残り時間**（一番重要）
2. **チャットメッセージ**（ゲームの中心）
3. **プレイヤーの状態**（誰が生きているか）
4. **イベントログ**（補助情報）

**操作のしやすさ**
- チャンネル切り替えはワンクリックで
- 接続状態が常に見える
- エラーが起きたらすぐに気づける

**没入感**
- ゲームの雰囲気を壊さないデザイン
- 落ち着いた色合い（派手すぎない）
- 目に優しい（長時間見ても疲れない）

## WebSocket通信仕様

### 接続

**エンドポイント**: `ws://localhost:8765`

**接続時の認証**:
```json
{
  "type": "godview",
  "password": "wolf"
}
```

### 受信メッセージ

#### 初期データ（init）
```json
{
  "type": "init",
  "current_phase": "discussion",
  "time_remaining": 45,
  "players": [
    {
      "id": "player1",
      "name": "アキラ",
      "role": "villager",
      "is_alive": true
    }
  ],
  "channels": {
    "public": {
      "name": "public",
      "messages": [...]
    },
    "werewolf": {
      "name": "werewolf",
      "messages": [...]
    }
  }
}
```

#### チャンネルメッセージ（channel_message）
```json
{
  "type": "channel_message",
  "channel": "public",
  "message": {
    "type": "chat",
    "timestamp": "2026-01-16T12:34:56",
    "player": "アキラ",
    "role": "villager",
    "content": "こんにちは"
  }
}
```

#### プレイヤー参加（player_joined）
```json
{
  "type": "player_joined",
  "player": {
    "id": "player1",
    "name": "アキラ",
    "role": "villager",
    "is_alive": true
  }
}
```

### 再接続ロジック

- 接続が切れた場合は自動的に再接続
- 最大再接続回数: 5回
- 再接続間隔: 3秒

## 追加で考慮してほしいこと

### パフォーマンス

- チャットメッセージは最新100件程度を保持
- 長時間の接続を考慮したメモリ管理

### アニメーション

- 新しいメッセージが表示される時のフェードイン
- フェーズが変わった時の視覚的なフィードバック
- 過度なアニメーションは避ける（落ち着かせる）

### デバイス対応

- デスクトップで見やすいこと
- タブレットでも見れること
- モバイルは最低限対応（必須ではない）

## 参考資料

- 現行のCLI実装: `server/godview.py`
- サーバー実装: `server/server.py`
- チャット仕様: `werewolf/README.md`

---

**作成日**: 2026-01-16
**バージョン**: 3.0.0（抽象化版）
